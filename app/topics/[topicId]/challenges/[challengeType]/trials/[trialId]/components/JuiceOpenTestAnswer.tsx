import { Challenge, JuiceChallenge, SplitDate, TomeTest, Trial } from "@/api/TomeChallengesAPI";

export function JuiceOpenTestAnswer({ trial, test, challenge }: { trial: Trial, test: TomeTest, challenge: JuiceChallenge }) {

    const testAnswer = trial.answers?.find(ta => ta.testId === test.testId);

    /**
     * Format answer based on test type
     */
    const formatAnswer = (answer: any, testType: string): string => {
        if (testType === 'date') {
            return formatSplitDate(answer);
        }
        return String(answer || '');
    };

    /**
     * Format a split date (with optional year, month, day)
     */
    const formatSplitDate = (splitDate: SplitDate | any): string => {
        if (!splitDate) return '(no answer)';

        const parts: string[] = [];
        if (splitDate.year !== null && splitDate.year !== undefined) parts.push(`${splitDate.year}`);
        if (splitDate.month !== null && splitDate.month !== undefined) parts.push(`${String(splitDate.month).padStart(2, '0')}`);
        if (splitDate.day !== null && splitDate.day !== undefined) parts.push(`${String(splitDate.day).padStart(2, '0')}`);

        if (parts.length === 0) return '(no answer)';
        return parts.join('-');
    };

    return (
        <div className="space-y-3">
            {/* User Answer */}
            <div>
                <span className="text-cyan-800 text-sm">Your Answer</span>
                <p className="text-cyan-800 mt-1 break-words text-sm">
                    {formatAnswer(testAnswer?.answer, test.type)}
                </p>
            </div>

            {/* Correct Answer */}
            <div>
                <span className="text-cyan-800 text-sm">These were the most important aspects to remember</span>
                <div className="text-cyan-800 mt-1 break-words">
                    {challenge.toRemember.map((item, idx) => (
                        <div className="flex items-center space-y-2" key={idx} >
                            <div className="rounded-full w-4 h-4 min-w-4 bg-cyan-200 text-sm flex items-center justify-center mr-4">{idx + 1}</div>
                            <span className="text-base">{item.toRemember}</span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    )

}
